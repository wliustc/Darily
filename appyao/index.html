<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />

	</head>

	<body>
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" id="index">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item">
				<span class="mui-icon mui-icon-phone" id="friend_list"></span>
				<span class="mui-tab-label">消息</span>
			</a>
			<a class="mui-tab-item">
				<span class="mui-icon mui-icon-email"></span>
				<span class="mui-tab-label">邮件</span>
			</a>
			<a class="mui-tab-item" id="self">
				<span class="mui-icon mui-icon-gear"></span>
				<span class="mui-tab-label">个人中心</span>
			</a>
		</nav>
	</body>
	<script src="js/mui.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		mui.init({
			subpages: [{
				url: "main.html",
				id: "main.html",
				styles: {
					top: "0",
					bottom: "50px"
				},
			}]
		});

		var ws = null;

		if(window.localStorage.getItem("user")) {
			ws = new WebSocket(window.ws_serv + "/app/" + window.localStorage.getItem("user"));
		};

		document.addEventListener("new_ws", function() {
			ws = new WebSocket(window.ws_serv + "/app/" + window.localStorage.getItem("user"));
		});
		
		document.getElementById('self').addEventListener('tap', function() {
			if(window.localStorage.getItem("user")) {
				mui.post(window.serv + '/auto_login', {
					"_id": window.localStorage.getItem("user")
				}, function(data) {
					console.log(JSON.stringify(data));
					mui.openWindow({
						url: "userinfo.html",
						id: "userinfo.html",
						styles: {
							top: "0px",
							bottom: "50px"
						},
						extras: data.data
					})
				}, 'json');

			} else {
				mui.openWindow({
					url: "login.html",
					id: "login.html",
					styles: {
						top: "0px",
						bottom: "50px"
					}

				})
			}

		});
		
		document.getElementById('index').addEventListener('tap', function() {
			mui.openWindow({
				url: "main.html",
				id: "main.html",
				styles: {
					top: "0px",
					bottom: "50px"
				}

			})
		});
		
		document.getElementById('friend_list').addEventListener('tap',function () {
		    mui.openWindow({
				url: "friend_list.html",
				id: "friend_list.html",
				styles: {
					top: "0px",
					bottom: "50px"
				}

			}) 
		})
		
		
	</script>

</html>